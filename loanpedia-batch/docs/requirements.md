# 要件定義書

## プロジェクト概要

青森県内の金融機関からローン情報を自動収集・AI 要約し、統合されたローン情報をエンドユーザーが検索・比較できるシステムの構築

## 機能要件

### 1. データ収集機能

- **機能**: バッチ処理により金融機関の Web サイトからローン情報を抽出
- **対象金融機関**:
  | 金融機関名 | 機関コード | 公式サイト |
  |------------|------------|------------|
  | 青森みちのく銀行 | 0117 | https://www.am-bk.co.jp/ |
  | 青い森信用金庫 | 1250 | https://www.aoimorishinkin.co.jp/ |
  | 東奥信用金庫 | 1251 | https://www.shinkin.co.jp/toshin/ |
  | 青森県信用組合 | 2260 | https://www.aomoriken.shinkumi.co.jp/ |

- **収集データ項目**: データベース設計書の `raw_loan_data` テーブルに準拠
  - HTML コンテンツ（全文保存）
  - 構造化抽出データ（商品名、金利、融資額等）
  - メタデータ（URL、取得日時、ハッシュ値等）

### 2. AI データ処理機能

- **機能**: BedRock API を使用した収集データの要約・構造化
- **処理内容**:
  - HTML からのローン情報抽出
  - 統一フォーマットでの構造化（JSON 形式）
  - データ検証・正規化
  - 要約テキストの生成
- **出力データ**: `processed_loan_data` テーブルの `ai_summary` フィールドに保存

### 3. データ保存機能

- **機能**: 段階的データ保存による処理状況管理
- **保存テーブル構成**:
  - `raw_loan_data`: 収集した生データ（HTML、抽出テキスト等）
  - `processed_loan_data`: AI 処理結果（要約、構造化データ）
  - `loan_products`: エンドユーザー向け統合ローン商品情報
- **統合商品データ項目**:
  - 基本情報: 商品名、商品コード、ローン種別、カテゴリ
  - 金利情報: 最低/最高金利、金利種別
  - 融資条件: 融資額範囲、融資期間、返済方法
  - 申込要件: 年齢制限、収入条件、保証人要件等
  - 商品特徴: その他特記事項

### 4. データ参照・検索機能

- **機能**: 統合されたローン情報の検索・比較
- **検索機能**:
  - 全文検索（商品名、概要）
  - 金利範囲指定
  - 融資額範囲指定
  - 金融機関フィルタ
  - ローンカテゴリフィルタ
- **提供方法**:
  - REST API（Laravel）
  - Web UI（React）
  - データ更新履歴の追跡

## 非機能要件

### 性能要件

- バッチ処理は定期実行（月次想定）
- データ更新の適切な頻度での実行
- AI 処理のレート制限対応

### 可用性要件

- システムの安定稼働
- エラーハンドリング機能
- リトライ機構

### セキュリティ要件

- 適切なアクセス制御
- データの安全な保存
- API レート制限

## 技術要件

### バッチ処理

- Web スクレイピング機能
- 定期実行スケジューリング
- 重複データ検出

### 生成 AI

- ローン情報の要約処理
- 構造化データの生成
- データ検証機能

### データベース

- 効率的なデータ保存・検索
- データの永続化
- 全文検索対応

### API/UI

- エンドユーザー向けインターフェース
- データ参照機能
- レスポンシブデザイン

## システム構成・処理フロー

### データ処理パイプライン

1. **データ収集フェーズ**

   ```
   金融機関サイト → [スクレイピング] → raw_loan_data
   ```

   - 月次バッチ実行
   - HTML コンテンツの全文保存
   - 重複チェック（content_hash）

2. **AI 処理フェーズ**

   ```
   raw_loan_data → [BedRock API] → processed_loan_data
   ```

   - 構造化データの抽出
   - データ検証・正規化
   - 要約テキスト生成

3. **統合フェーズ**

   ```
   processed_loan_data → [データ統合] → loan_products
   ```

   - 重複商品の統合
   - 履歴データの作成
   - 検索インデックスの更新

4. **ユーザーアクセスフェーズ**
   ```
   loan_products → [Laravel API] → [React UI] → エンドユーザー
   ```

## 技術スタック詳細

### バックエンドシステム

- **バッチ処理**: Python 3.12 + AWS Lambda

  - Web スクレイピング: BeautifulSoup4, requests
  - スケジュール: EventBridge または Cron
  - エラーハンドリング: リトライ機構 + CloudWatch

- **AI 処理**: Amazon BedRock API
  - Claude 3 モデル使用
  - JSON スキーマ検証
  - レートリミット対応

### データストレージ

- **データベース**: MySQL 8.0
  - フルテキスト検索対応
  - JSON カラム活用
  - インデックス最適化

### API・フロントエンド

- **API**: PHP 8.2 + Laravel 10

  - RESTful API
  - ページネーション対応
  - API レートリミット

- **フロントエンド**: React 18 + JavaScript
  - レスポンシブデザイン
  - 検索・フィルタ機能
  - ローン比較機能
